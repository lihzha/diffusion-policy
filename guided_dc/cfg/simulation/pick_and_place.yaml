defaults:
  - _self_

pause: false
quiet: true
seed: null

env:
  env_id: PickAndPlace-v1
  num_envs: 1
  robot_uids: panda_wristcam_irom # panda, (panda, panda)
  obs_mode: rgb
  render_mode: sensors # rgb_array, human, sensors, all
  reward_mode: null
  control_mode: pd_joint_pos  # 'pd_joint_delta_pos', 'pd_joint_pos', 'pd_ee_delta_pos', 'pd_ee_delta_pose', 'pd_ee_pose', 'pd_joint_target_delta_pos', 'pd_ee_target_delta_pos', 'pd_ee_target_delta_pose', 'pd_joint_vel', 'pd_joint_pos_vel', 'pd_joint_delta_pos_vel'
  sim_backend: auto
  shader: rt  # minimal, default, rt

  scene_builder:
    floor_texture_file: ${oc.env:GDC_ASSETS_DIR}/floor/silver_wood.jpg
    robot_init_qpos: [0, -0.62831853, 0, -2.51327412, 0, 1.88495559, 0, 0.04, 0.04]
    robot_init_pos: [-0.547, -0.527, -0.143]
    robot_init_rot: [0, 0, "${pi_op:div,4}"]
    table:
      model_file: ${oc.env:GDC_ASSETS_DIR}/table/table_with_textured_top.obj
      material_file: ${oc.env:GDC_ASSETS_DIR}/table/material_0.png
      table_height: 0.0
      # for building table
      thickness: 0.05  # in meters
      width: 0.715   # in meters
      length: 1.4   # in meters
      leg_length: 0.75
      leg_thickness: 0.05
    background:
      model_file: ${oc.env:GDC_ASSETS_DIR}/background/background_full.obj
      pos: [0.04, -0.39, -0.105]
      rot: [0, 0, 0]
    distractor:
      # - type: custom
      #   obj_name: pear
      #   model_file: ${oc.env:GDC_ASSETS_DIR}/objects/pear.glb
      #   pos: [-0.1, 0.025, 0.3]
      #   rot: [0,0,0]
      #   scale: [0.05, 0.05, 0.05]
      - type: custom
        obj_name: bowl
        model_file: ${oc.env:GDC_ASSETS_DIR}/objects/bowl.glb
        pos: [-0.3, 0.025, 0.1]
        rot: [0,0,0]
        scale: [0.01, 0.01, 0.01]
      # - type: custom
      #   obj_name: apple
      #   model_file: ${oc.env:GDC_ASSETS_DIR}/objects/apple.glb
      #   pos: [-0.1, 0.025, 0.15]
      #   rot: [0, 0, 0]
      #   scale: [0.01, 0.01, 0.01]

  camera:
    wrist_camera:
      eye:
        - [-1, 1, 0.5]
      target:
        - [0,0, 0.]
      use_pose: true
      pose:
        - [0.0916, -0.0755, 0.0131, 0.4148, -0.3362, -0.8250, -0.1850]
        # - [0.0854, -0.0735, 0.0282, 0.4105, -0.3239, -0.8375, -0.1588] # Before calibration
      width: 640   # 424
      height: 480
      # fov: ${pi_op:mul,5/12}
      near: 0.01
      far: 100
      intrinsic:
        # - [217.267, 0., 214.218]
        # - [0. , 216.97, 122.577]
        # - [0.0, -0.0, 1.]
        - [454.5, 0., 324.4]
        - [0. , 433.9, 245.2]
        - [0.0, -0.0, 1.]
        # - [391.04746246430125, 0.0, 326.98570796916977]
        # - [0.0, 391.07204451229177, 242.77958105302346]
        # - [0.0, 0.0, 1.0]
    sensor:
      eye:
        - [-1, 1, 0.5]
      target:
        - [0,0, 0.]
      use_pose: true
      pose:
        - [-0.7615008420670445, 0.26441512270901735, 0.58827, 0.9004786174973238, 0.07515193737369871, 0.36950703333614043, -0.21669101978211416]
      width: 640
      height: 480
      # fov: ${pi_op:mul,35/180}
      near: 0.01
      far: 100
      intrinsic:
        - [650, 0, 319.5]
        - [0, 650, 239.5]
        - [0, 0, 1]
    viewer:
      eye:
        - [-1, 1, 0.5]
      target:
        - [0,0, 0.]
      use_pose: false
      pose:
        - [0,0,0,1,0,0,0]
      fov: ${pi_op:div,2}
      width: 1920
      height: 1080
      near: 0.01
      far: 100

    human_render:
      eye:
        - [-1, 1, 0.5]
      target:
        - [0,0, 0.]
      use_pose: false
      pose:
        - [0,0,0,1,0,0,0]
      fov: ${pi_op:mul,35/180}
      width: 1024
      height: 1024
      near: 0.01
      far: 100

  manip_obj:   #TODO: enable different objects to different subscenes
    type: custom # custom, ai2thor
    filepath: ${oc.env:GDC_ASSETS_DIR}/objects/tomato.glb
    pos: [-0.3,0.1,0] # for 40.h5
    # pos: [-0.4,0.1,0.0]
    # pos: [-0.45,-0.1,0]
    rot: [-1.57265, -0.0464526,  3.0965]
    scale: [0.8,0.8,0.8]
    physics:
      static_friction: 1
      dynamic_friction: 1
      restitution: 1  # Bounciness
    # visuals:
    #   base_color: [0.75, 0.1, 0.1, 1.0]
      # metallic: 0.0
      # roughness: 0.1
      # emission: [0., 0., 0., 0.]

  goal_obj:
    type: custom # custom, ai2thor
    filepath: ${oc.env:GDC_ASSETS_DIR}/objects/plate.glb
    # obj_name: plate
    # pos: [-0.35,0.1,0.0083]  # for 40.h5
    pos: [-0.5,0.025,0.01]
    # pos: [-0.25,0.1,0]
    rot: [1.569,2.9,-0.001066]
    scale: [0.1,0.08,0.1]
    physics:
      static_friction: 1
      dynamic_friction: 1
      restitution: 1  # Bounciness
    # visuals:
      # base_color: [0.75, 0.75, 0.75, 1.0]
      # base_color: [0,0,0,1]
      # metallic: 1.0
      # roughness: 0.1
      # emission: [0., 0., 0., 0.]

  lighting:
    ambient: [0.6, 0.6, 0.6]

  grasp:
    num_action_candidates: 1
    max_pushin_dist: 0.05
    min_pushin_dist: -0.01

  randomization:
    robot:
      robot_init_qpos_noise: 0.0   # Conform to maniskill API
      pos:
        value_range: # When distribution is normal, the range is [mean, std]
          - [0.0, 0.0]
          - [0.0, 0.0]
          - [0.0, 0.0]
        operation: "additive"
        distribution: "uniform"   # normal, uniform
        # schedule: "constant"  # turn on noise after `schedule_steps` num steps
        # schedule_steps: 5000
        # setup_only: True
      rot:
        value_range:
          - [0.0, 0.0]
          - [0.0, 0.0]
          - [0.0, 0.0]
        operation: "additive"
        distribution: "uniform"

    manip_obj:
      pos:
        value_range:
          - [-0.0, 0.0]
          - [-0.0, 0.0]
          - [0.0, 0.0]
        operation: "additive"
        distribution: "uniform"
      rot:
        value_range:
          - [0.0, 0.0]
          - [0.0, 0.0]
          - [0.0, 0.0]
        operation: "absolute"
        distribution: "uniform"

    goal_obj:
      pos:
        value_range:
          - [0.0, 0.0]
          - [-0.0, 0.0]
          - [0.0, 0.0]
        operation: "additive"
        distribution: "uniform"
      rot:
        value_range:
          - [0.0, 0.0]
          - [0.0, 0.0]
          - [0.0, 0.0]
        operation: "absolute"
        distribution: "uniform"

    camera:
      pos:
        value_range:
          - [0.0, 0.0]
          - [0.0, 0.0]
          - [0.0, 0.0]
        operation: "additive"
        distribution: "uniform"
      rot:
        value_range:
          - [-0.1, 0.1]
          - [-0.1, 0.1]
          - [-0.1, 0.1]
        operation: "additive"
        distribution: "uniform"

    lighting:
      ambient:
        value_range:
          - [0.3, 1]
          - [0.3, 1]
          - [0.3, 1]
        operation: "absolute"
        distribution: "uniform"


record:
  output_dir: './videos'
  save_video: True
  save_on_reset: True
  info_on_video: False
  save_trajectory: False
  record_env_state: False
  trajectory_name: ${env.env_id}_numenvs${env.num_envs}


rrt:
  rnd: 1
  replay_with_controller: true
  smooth_iter: 10
  data_iter: 1
  save_video: True
  rrt_iter: 100
  traj_path: videos/PickAndPlace-v1_numenvs4_datarnd2_seedNone_20241020_224956.h5
  traj_idx: 3
